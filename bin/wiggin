#!/usr/bin/env node

var minimist = require('minimist')
var clone = require('clone')
var argv = minimist(process.argv.slice(2))
var rimraf = require('rimraf')
var exec = require('child_process').exec

var tasks = {
  'compile-views': function (flags) {
    console.log(flags)
    rimraf.sync('./public/js/views')
    exec(__dirname + '/../node_modules/jade/bin/jade.js --client --no-debug --path ./ ' + flags.viewpath, function (error, stdout, stderr) {
      require(__dirname + '/../tasks/build-client-views').write(flags.viewpath, 'public/js/views/', function () {
        !error && console.log('successfully compiled client views')
      })
    })
  }
}

argv._.forEach(function (task) {
  tasks[task] && tasks[task](clone(argv))
})
